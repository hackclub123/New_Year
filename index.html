<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âœ¨ Happy New Year 2026 | Create Your Magic Wish</title>
    
    <link rel="preconnect" href="https://www.highperformanceformat.com">
    <link rel="preconnect" href="https://pl28318616.effectivegatecpm.com">
    <link rel="dns-prefetch" href="https://www.highperformanceformat.com">
    <link rel="dns-prefetch" href="https://pl28318616.effectivegatecpm.com">
    <meta name="description" content="Create your magical, personalized New Year 2026 greeting card! Upload your photo, add a wish, and share the wonder.">
    <meta property="og:title" content="ðŸŒŸ A Magical New Year 2026 Wish for You!">
    <meta property="og:image" content="https://res.cloudinary.com/daotoaegm/image/upload/v1/sample.jpg"> <meta property="og:type" content="website">
    <meta name="theme-color" content="#050518">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* ==================== CORE CSS ==================== */
        :root {
            --bg-deep: #02020a;
            --theme-color: #ffd700; /* Default Gold */
            --theme-glow: rgba(255, 215, 0, 0.6);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow-x: hidden; font-family: 'Poppins', sans-serif; background: var(--bg-deep); color: #fff; }
        
        .stars { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at center, #1a0b2e 0%, #02020a 100%); }
        #fireworksCanvas { position: fixed; inset: 0; pointer-events: none; z-index: 0; }

        /* ==================== ADS CONFIG ==================== */
        /* Sticky Top Ad (320x50) */
        .ad-sticky-top {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: #000; z-index: 900; display: flex; justify-content: center; align-items: center;
            border-bottom: 1px solid #333;
        }
        /* Container padding to prevent content hiding behind ad */
        .container {
            padding-top: 80px; /* Space for top ad */
            padding-bottom: 100px; /* Space for bottom share */
            max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; position: relative; z-index: 10;
        }
        .ad-native-container {
            width: 100%; margin: 15px 0; overflow: hidden; border-radius: 8px; border: 1px dashed #333;
            min-height: 100px; background: rgba(255,255,255,0.02); display: flex; justify-content: center; align-items: center;
        }

        /* ==================== UI ELEMENTS ==================== */
        h1.hero-title {
            font-family: 'Playfair Display', serif; font-size: 2.5rem; 
            background: linear-gradient(to right, #fff, var(--theme-color), #fff); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 10px 0; text-align: center;
            text-shadow: 0 0 20px var(--theme-glow);
            transition: 0.3s;
        }

        /* Countdown */
        .countdown-box { display: flex; gap: 8px; margin: 15px 0; justify-content: center; }
        .time-unit {
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 8px; border-radius: 8px; text-align: center; min-width: 55px;
            backdrop-filter: blur(5px);
        }
        .time-val { font-size: 1.3rem; font-weight: bold; color: var(--theme-color); display: block; transition: 0.3s; }
        .time-label { font-size: 0.6rem; text-transform: uppercase; opacity: 0.8; }

        /* THE CARD (Dynamic Colors) */
        .card-stage { width: 90%; perspective: 1000px; margin: 20px 0; }
        .wishing-card {
            background: rgba(0,0,0,0.7); 
            border: 2px solid var(--theme-color);
            border-radius: 15px; padding: 25px; text-align: center;
            position: relative; overflow: hidden; transform-style: preserve-3d;
            box-shadow: 0 0 30px var(--theme-glow); 
            transition: all 0.4s ease;
        }
        /* Holographic Sheen */
        .wishing-card::after { 
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none; mix-blend-mode: overlay;
        }
        
        .photo-frame {
            width: 140px; height: 140px; margin: 0 auto 15px;
            border-radius: 50%; 
            border: 3px solid var(--theme-color);
            padding: 4px; 
            box-shadow: 0 0 15px var(--theme-glow);
            transition: 0.3s;
        }
        .user-photo { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; background: #222; }
        
        .card-name { 
            font-family: 'Playfair Display', serif; font-size: 1.8rem; 
            color: var(--theme-color); margin: 10px 0; transition: 0.3s;
        }
        .card-msg { font-size: 0.95rem; font-style: italic; color: #ddd; min-height: 40px; }
        .card-year { 
            font-size: 4rem; font-weight: 900; opacity: 0.1; position: absolute; 
            bottom: -15px; right: 10px; line-height: 1; pointer-events: none;
        }

        /* Controls */
        .control-panel { background: var(--glass); padding: 20px; border-radius: 15px; width: 90%; border: 1px solid var(--glass-border); }
        input[type="text"], textarea {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid #444;
            color: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-family: inherit;
        }
        
        .theme-toggles { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 15px 0; }
        .theme-btn { 
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer; 
            border: 2px solid rgba(255,255,255,0.2); transition: 0.2s; position: relative;
        }
        .theme-btn.active { transform: scale(1.2); border-color: #fff; box-shadow: 0 0 10px white; }

        .btn-primary {
            width: 100%; background: linear-gradient(45deg, var(--theme-color), #fff);
            color: #000; border: none; padding: 15px; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.3s;
        }

        /* SHARE BAR */
        .share-sticky {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            padding: 12px 5px; display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 5px; border-top: 1px solid #333; z-index: 100;
            transform: translateY(100%); transition: transform 0.3s;
        }
        .share-sticky.visible { transform: translateY(0); }
        
        .share-btn {
            background: none; border: none; color: white; font-size: 0.75rem; 
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
        }
        .share-icon-circle {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; margin-bottom: 4px; color: white;
        }
        
        .bg-wa { background: #25D366; }
        .bg-fb { background: #1877F2; }
        .bg-ig { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        .bg-copy { background: #555; }

        /* ==================== MIND-BLOWING OPENING PORTAL ==================== */
#curtain {
    position: fixed; inset: 0; 
    /* CHANGED: Pure Black Background for maximum contrast */
    background: #000000;
    z-index: 9999;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1), opacity 0.8s;
    overflow: hidden;
}

/* The Rotating Energy Rings */
.portal-container {
    position: relative; width: 300px; height: 300px;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 40px;
}

.ring {
    position: absolute; border-radius: 50%;
    border: 3px solid transparent; /* Thicker border for better visibility */
}

/* Ring 1: The Main Pulsing Ring */
.ring-1 {
    width: 100%; height: 100%;
    border-top: 5px solid #ff00ff; /* Start Pink */
    border-bottom: 5px solid #ff00ff;
    /* Added 'neonCycle' animation to change colors */
    animation: spin 4s linear infinite, neonCycle 2s linear infinite; 
}

/* Ring 2: The Inner Fast Ring */
.ring-2 {
    width: 75%; height: 75%;
    border-left: 3px solid #00ffff; /* Start Cyan */
    border-right: 3px solid #00ffff;
    /* Reverse spin + Faster color change (1s) */
    animation: spinReverse 6s linear infinite, neonCycle 1s linear infinite reverse; 
}

/* Ring 3: The Outer Detail Ring */
.ring-3 {
    width: 130%; height: 130%;
    border: 1px dashed rgba(255,255,255,0.4);
    animation: spin 15s linear infinite;
}

/* The Glowing 2026 */
.curtain-logo {
    font-family: 'Playfair Display', serif;
    font-size: 4rem; 
    color: #fff;
    /* Dynamic Shadow matching the neon theme */
    text-shadow: 0 0 20px #fff; 
    position: relative; z-index: 10;
    animation: heartbeat 0.8s ease-in-out infinite alternate; /* Faster heartbeat */
}

/* The "Unlock" Button */
.unlock-btn {
    position: relative;
    padding: 18px 50px;
    background: transparent;
    color: #fff;
    font-family: 'Poppins', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    border: 2px solid #fff; /* High contrast border */
    border-radius: 50px;
    cursor: pointer;
    overflow: hidden;
    transition: 0.3s;
    box-shadow: 0 0 15px rgba(255,255,255,0.3);
    backdrop-filter: blur(5px);
}

.unlock-btn::before {
    content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, #fff, transparent);
    animation: shine 3s infinite;
}

.unlock-btn:active { transform: scale(0.95); background: #fff; color: #000; }

.instruction-text {
    margin-top: 20px; color: #fff; 
    font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase;
    animation: blink 1s infinite; /* Faster blink */
}

/* Hiding Animation */
.curtain-hidden { transform: scale(1.5); opacity: 0; pointer-events: none; }

/* --- ANIMATIONS --- */

/* NEW: The Color Changing Engine */
@keyframes neonCycle {
    0%   { border-color: #ff00ff; box-shadow: 0 0 20px #ff00ff, inset 0 0 10px #ff00ff; } /* Neon Pink */
    25%  { border-color: #00ffff; box-shadow: 0 0 20px #00ffff, inset 0 0 10px #00ffff; } /* Cyan */
    50%  { border-color: #00ff00; box-shadow: 0 0 20px #00ff00, inset 0 0 10px #00ff00; } /* Lime Green */
    75%  { border-color: #ffff00; box-shadow: 0 0 20px #ffff00, inset 0 0 10px #ffff00; } /* Bright Yellow */
    100% { border-color: #ff00ff; box-shadow: 0 0 20px #ff00ff, inset 0 0 10px #ff00ff; } /* Back to Pink */
}

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes spinReverse { 0% { transform: rotate(360deg); } 100% { transform: rotate(0deg); } }
@keyframes heartbeat { 0% { transform: scale(1); text-shadow: 0 0 20px #fff; } 100% { transform: scale(1.1); text-shadow: 0 0 40px #ff00ff; } }
@keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }
@keyframes blink { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        
        /* Music & Toast */
        .music-toggle {
            position: fixed; top: 70px; right: 20px; width: 40px; height: 40px;
            background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; z-index: 800; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .music-anim { animation: spin 4s linear infinite; }

        #toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); color: #fff; padding: 15px 30px; border-radius: 30px;
            opacity: 0; transition: 0.3s; pointer-events: none; z-index: 3000; font-size: 1rem;
            border: 1px solid var(--theme-color); text-align: center;
        }

        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        @keyframes spin { 100%{transform:rotate(360deg)} }
    </style>
    <script async="async" data-cfasync="false" src="//pl28318616.effectivegatecpm.com/610ad41517580c9bdd0d14f91c1ff097/invoke.js"></script>
</head>
<body oncontextmenu="return false;">

    <div class="ad-sticky-top">
        <script>
            atOptions = {
                'key' : 'ca0ab62d456d999df288b7ebea031acb',
                'format' : 'iframe',
                'height' : 50,
                'width' : 320,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/ca0ab62d456d999df288b7ebea031acb/invoke.js"></script>
    </div>

    <audio id="bgMusic" loop>
        <source src="newyear.mp3" type="audio/mpeg">
    </audio>

    <div id="curtain">
        <div class="portal-container">
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
            <div class="ring ring-3"></div>
            <div class="curtain-logo">2026</div>
        </div>
        
        <button class="unlock-btn" onclick="unleashMagic()">
            Unlock The Magic
        </button>
        
        <p class="instruction-text">Turn Sound On ðŸ”Š</p>
    </div>

    <div class="stars"></div>
    <canvas id="fireworksCanvas"></canvas>

    <div class="container">
        <div class="music-toggle" onclick="toggleMusic()"><i class="fas fa-music"></i></div>
        
        <h1 class="hero-title">Happy New Year</h1>
        
        <div class="countdown-box">
            <div class="time-unit"><span class="time-val" id="d">00</span><span class="time-label">D</span></div>
            <div class="time-unit"><span class="time-val" id="h">00</span><span class="time-label">H</span></div>
            <div class="time-unit"><span class="time-val" id="m">00</span><span class="time-label">M</span></div>
            <div class="time-unit"><span class="time-val" id="s">00</span><span class="time-label">S</span></div>
        </div>

        <p style="color: #bbb; font-size: 0.9rem; text-align:center; margin-bottom:20px;">
            <i class="fas fa-eye"></i> <span id="viewCount">1,204,592</span> views today
        </p>

        <div class="card-stage">
            <div class="wishing-card" id="finalCard">
                <div class="photo-frame">
                    <img src="https://res.cloudinary.com/daotoaegm/image/upload/v1/sample.jpg" id="cardImg" class="user-photo" alt="Photo">
                </div>
                <h2 class="card-name" id="cardNameDisplay">Your Name</h2>
                <div class="card-msg" id="cardMsgDisplay">Wishing you joy, prosperity, and magic in 2026! âœ¨</div>
                <div class="card-year">2026</div>
            </div>
        </div>

        <div id="creatorPanel" class="control-panel">
            <h3 style="color:var(--theme-color); text-align:center; margin-bottom:15px;">Customize Yours ðŸŽ¨</h3>
            
            <input type="text" id="inputName" placeholder="Enter Your Name..." maxlength="20">
            
            <label class="btn-primary" style="background:#222; color:#fff; border:1px solid #444; margin-bottom:10px;">
                <i class="fas fa-cloud-upload-alt"></i> Upload Photo
                <input type="file" id="imgUpload" accept="image/*" style="display: none;" onchange="handleCloudinaryUpload(this)">
            </label>
            
            <textarea id="inputMsg" rows="2" placeholder="Write a short wish..." maxlength="60"></textarea>

            <p style="text-align:center; font-size:0.8rem; margin-top:5px;">Pick a Vibe:</p>
            <div class="theme-toggles">
                <div class="theme-btn" style="background:#ffd700" onclick="updateColor('#ffd700')" title="Gold"></div>
                <div class="theme-btn" style="background:#ff00de" onclick="updateColor('#ff00de')" title="Neon Pink"></div>
                <div class="theme-btn" style="background:#00f3ff" onclick="updateColor('#00f3ff')" title="Cyan"></div>
                <div class="theme-btn" style="background:#ff2222" onclick="updateColor('#ff2222')" title="Red"></div>
                <div class="theme-btn" style="background:#00ff40" onclick="updateColor('#00ff40')" title="Green"></div>
                <div class="theme-btn" style="background:#ffffff" onclick="updateColor('#ffffff')" title="Silver"></div>
            </div>

            <div class="ad-native-container">
               
               <div id="container-610ad41517580c9bdd0d14f91c1ff097"></div>
            </div>

            <button class="btn-primary" onclick="generateLink()">
                <i class="fas fa-magic"></i> Generate & Share
            </button>
        </div>

        <div id="viewModeControls" style="text-align:center; width:100%; display:none; margin-top: 20px;">
            <button class="btn-primary" onclick="window.location.href=window.location.href.split('?')[0]">
                Create My Own Greeting ðŸš€
            </button>
        </div>
    </div>

    <div class="share-sticky" id="shareBar">
        <button class="share-btn" onclick="shareTo('wa')">
            <div class="share-icon-circle bg-wa"><i class="fab fa-whatsapp"></i></div>
            WhatsApp
        </button>
        <button class="share-btn" onclick="shareTo('fb')">
            <div class="share-icon-circle bg-fb"><i class="fab fa-facebook-f"></i></div>
            Facebook
        </button>
        <button class="share-btn" onclick="shareTo('ig')">
            <div class="share-icon-circle bg-ig"><i class="fab fa-instagram"></i></div>
            Instagram
        </button>
        <button class="share-btn" onclick="shareTo('copy')">
            <div class="share-icon-circle bg-copy"><i class="fas fa-link"></i></div>
            Copy Link
        </button>
    </div>

    <div id="toast"></div>

    <script>
        // --- CONFIG ---
        const TARGET_DATE = new Date("January 1, 2026 00:00:00").getTime();
        const BASE_URL = window.location.href.split('?')[0];
        let uploadedImgUrl = ''; 
        let currentHex = '#ffd700';

        // --- CLOUDINARY CONFIG ---
        const CLOUD_NAME = "daotoaegm"; 
        // IMPORTANT: You must create an "Unsigned" Upload Preset in Cloudinary Settings!
        // Name it 'ny2026_guest' (or change the string below).
        const UPLOAD_PRESET = "ny2026_guest"; 

        // --- INIT ---
        window.onload = function() {
            startCountdown();
            initFireworks();
            parseURL();
            setInterval(() => {
                let c = document.getElementById('viewCount');
                c.innerText = (parseInt(c.innerText.replace(/,/g,'')) + Math.floor(Math.random()*10)).toLocaleString();
            }, 5000);
        };

        function unleashMagic() {
            document.getElementById('curtain').classList.add('curtain-hidden');
            toggleMusic(true);
        }

        // --- THEME COLOR LOGIC (FIXED) ---
        function updateColor(hex) {
            currentHex = hex;
            // Update CSS Variables to change everything (Border, Glow, Text)
            document.documentElement.style.setProperty('--theme-color', hex);
            document.documentElement.style.setProperty('--theme-glow', hex + '99'); // Add transparency
            
            // Visual feedback on buttons
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- PREVIEWS ---
        document.getElementById('inputName').addEventListener('input', (e) => {
            document.getElementById('cardNameDisplay').innerText = e.target.value || "Your Name";
        });
        document.getElementById('inputMsg').addEventListener('input', (e) => {
            document.getElementById('cardMsgDisplay').innerText = e.target.value || "Wishing you joy, prosperity, and magic in 2026! âœ¨";
        });

        // --- CLOUDINARY UPLOAD (New) ---
        function handleCloudinaryUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                showToast("Uploading to Cloud... â˜ï¸");

                // Show local preview immediately
                const reader = new FileReader();
                reader.onload = e => document.getElementById('cardImg').src = e.target.result;
                reader.readAsDataURL(file);

                const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', UPLOAD_PRESET); 

                fetch(url, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.secure_url) {
                        uploadedImgUrl = data.secure_url;
                        showToast("Image Uploaded! âœ…");
                    } else {
                        console.error(data);
                        showToast("Check Upload Preset Settings"); 
                    }
                })
                .catch(err => {
                    console.error(err);
                    showToast("Upload Error");
                });
            }
        }

        // --- GENERATE LINK ---
        function generateLink() {
            const name = document.getElementById('inputName').value.trim();
            if(!name) { showToast("Please write your name!"); return; }
            
            const msg = document.getElementById('inputMsg').value.trim();
            
            const params = new URLSearchParams();
            params.set('n', encodeURIComponent(name));
            if(uploadedImgUrl) params.set('i', encodeURIComponent(uploadedImgUrl));
            if(msg) params.set('m', encodeURIComponent(msg));
            params.set('c', encodeURIComponent(currentHex)); // Save color

            const finalURL = `${BASE_URL}?${params.toString()}`;
            window.history.pushState({}, '', finalURL);
            
            document.getElementById('shareBar').classList.add('visible');
            document.querySelector('.card-stage').scrollIntoView({behavior:'smooth'});
            showToast("âœ¨ Ready to Share! See bottom bar.");
        }

        // --- READ URL ---
        function parseURL() {
            const params = new URLSearchParams(window.location.search);
            if(params.has('n')) {
                const name = decodeURIComponent(params.get('n'));
                const img = params.get('i') ? decodeURIComponent(params.get('i')) : "https://res.cloudinary.com/daotoaegm/image/upload/v1/sample.jpg";
                const msg = params.get('m') ? decodeURIComponent(params.get('m')) : "Happy New Year 2026!";
                const color = params.get('c') ? decodeURIComponent(params.get('c')) : '#ffd700';

                document.getElementById('cardNameDisplay').innerText = name;
                document.getElementById('cardImg').src = img;
                document.getElementById('cardMsgDisplay').innerText = msg;
                updateColor(color);

                document.getElementById('creatorPanel').style.display = 'none';
                document.getElementById('viewModeControls').style.display = 'block';
                document.getElementById('shareBar').classList.add('visible');
            }
        }

        // --- SHARE + INSTAGRAM LOGIC ---
        function shareTo(platform) {
            const url = window.location.href;
            const text = `ðŸŒŸ ${document.getElementById('cardNameDisplay').innerText} sent you a magical wish!`;
            
            if(platform === 'wa') {
                window.open(`https://wa.me/?text=${encodeURIComponent(text + " " + url)}`, '_blank');
            } else if(platform === 'fb') {
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
            } else if(platform === 'copy') {
                navigator.clipboard.writeText(url);
                showToast("Link Copied! ðŸ“‹");
            } else if(platform === 'ig') {
                showToast("Preparing for Instagram Story... ðŸ“¸");
                const card = document.getElementById('finalCard');
                
                // 1. Generate Image
                html2canvas(card, { useCORS: true, scale: 2, backgroundColor: null }).then(canvas => {
                    const imgData = canvas.toDataURL("image/png");
                    
                    // 2. Trigger Download
                    const link = document.createElement('a');
                    link.download = 'My-NY2026-Story.png';
                    link.href = imgData;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // 3. Try to open Instagram (Best effort)
                    setTimeout(() => {
                        // On mobile, this tries to open the app. On desktop, goes to website.
                        // Note: Browsers block direct image insertion into Story for security.
                        window.location.href = "instagram://story-camera"; 
                        showToast("Saved! Open Instagram & select photo ðŸ“²");
                    }, 1500);
                });
            }
        }

        // --- UTILS ---
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 3000);
        }

        function toggleMusic(forcePlay) {
            const aud = document.getElementById('bgMusic');
            const icon = document.querySelector('.music-toggle i');
            const btn = document.querySelector('.music-toggle');
            if(forcePlay || aud.paused) {
                aud.play().catch(e=>console.log("Audio requires touch"));
                icon.className = 'fas fa-pause';
                btn.classList.add('music-anim');
            } else {
                aud.pause();
                icon.className = 'fas fa-music';
                btn.classList.remove('music-anim');
            }
        }

        function startCountdown() {
            setInterval(() => {
                const dist = TARGET_DATE - new Date().getTime();
                if(dist < 0) return;
                document.getElementById("d").innerText = Math.floor(dist / (1000 * 60 * 60 * 24));
                document.getElementById("h").innerText = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById("m").innerText = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById("s").innerText = Math.floor((dist % (1000 * 60)) / 1000);
            }, 1000);
        }

        // --- FIXED FIREWORKS ENGINE ---
        function initFireworks() {
            const canvas = document.getElementById('fireworksCanvas');
            const ctx = canvas.getContext('2d');
            let w, h, particles = [];

            const resize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; };
            window.addEventListener('resize', resize);
            resize();

            function createParticle(x, y) {
                const count = 20; // Particles per explosion
                for(let i=0; i<count; i++) {
                    particles.push({
                        x: x, y: y,
                        vx: (Math.random() - 0.5) * 6,
                        vy: (Math.random() - 0.5) * 6,
                        alpha: 1,
                        color: `hsl(${Math.random()*360}, 100%, 60%)`
                    });
                }
            }

            // Loop logic
            function loop() {
                requestAnimationFrame(loop);
                // Clear screen with trail effect
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; 
                ctx.fillRect(0, 0, w, h);
                
                ctx.globalCompositeOperation = 'lighter';

                // Random explosions
                if(Math.random() < 0.05) { // 5% chance per frame
                    createParticle(Math.random() * w, Math.random() * h);
                }

                for(let i = particles.length - 1; i >= 0; i--) {
                    let p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.05; // Gravity
                    p.alpha -= 0.02; // Fade

                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                    ctx.fill();

                    if(p.alpha <= 0) particles.splice(i, 1);
                }
            }
            loop(); // Start animation
        }
    </script>
</body>
</html>



